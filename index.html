<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Tarefas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-title {
            text-align: center;
            color: #4CAF50;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 30px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .counters-container {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .form-row {
            display: grid;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row-2 {
            grid-template-columns: 1fr 1fr;
        }

        .form-row-3 {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #e9ecef;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .button-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background-color: #45a049;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .counters-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .counter-item {
            text-align: center;
            padding: 10px;
        }

        .counter-number {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }

        .counter-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .high-priority-section {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #ffeaa7;
            margin-bottom: 20px;
        }

        .task-list-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .filters-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .task-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .task-table th,
        .task-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .task-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        .task-table tr:hover {
            background-color: #f5f5f5;
        }

        .clickable-task {
            cursor: pointer;
            color: #007bff;
            text-decoration: underline;
        }

        .clickable-task:hover {
            color: #0056b3;
        }

        .nova-tarefa-alert {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            animation: blink 2s linear 3;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .edit-section {
            background-color: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #bbdefb;
        }

        .edit-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-aberta { background-color: #fff3cd; color: #856404; }
        .status-execucao { background-color: #cce5ff; color: #004085; }
        .status-concluido { background-color: #d4edda; color: #155724; }
        .status-aguardando { background-color: #f8d7da; color: #721c24; }

        .priority-alta { color: #dc3545; font-weight: bold; }
        .priority-media { color: #fd7e14; }
        .priority-baixa { color: #28a745; }

        .hidden {
            display: none;
        }

        .dashboard-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        #pieChart {
            width: 100%;
            height: 300px;
        }

        .admin-section {
            background-color: #e9ecef;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
            margin-bottom: 20px;
        }

        .solicitantes-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="main-title">Gerenciamento de Tarefas</h1>
        
        <!-- Notifica√ß√£o de nova tarefa -->
        <div id="novaTagrefaAlert" class="nova-tarefa-alert hidden">
            üîî Nova tarefa adicionada com sucesso!
        </div>

        <!-- Navega√ß√£o -->
        <div style="margin-bottom: 20px;">
            <button class="btn btn-primary" onclick="showPage('dashboard')">Dashboard Principal</button>
            <button class="btn btn-secondary" onclick="showPage('admin')">Administrador</button>
            <button class="btn btn-secondary" onclick="showPage('relatorios')">Relat√≥rios</button>
        </div>

        <!-- P√°gina Dashboard Principal -->
        <div id="dashboardPage">
            <div class="main-layout">
                <!-- Formul√°rio -->
                <div class="form-container">
                    <div class="form-row form-row-2">
                        <div class="form-group">
                            <label for="cpf">CPF Associado</label>
                            <input type="text" id="cpf" placeholder="000.000.000-00">
                        </div>
                        <div class="form-group">
                            <label for="nome">Nome Associado</label>
                            <input type="text" id="nome" placeholder="Nome completo">
                        </div>
                    </div>

                    <div class="form-row form-row-3">
                        <div class="form-group">
                            <label for="solicitante">Solicitante</label>
                            <select id="solicitante">
                                <option value="Josiane">Josiane</option>
                                <option value="Val">Val</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="prioridade">Prioridade</label>
                            <select id="prioridade" onchange="toggleDataPrazo()">
                                <option value="Baixa">Baixa</option>
                                <option value="M√©dia">M√©dia</option>
                                <option value="Alta">Alta</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dataPrazo">Data Prazo (se Alta)</label>
                            <input type="date" id="dataPrazo" disabled>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="observacoes">Ressalva</label>
                            <textarea id="observacoes" placeholder="Observa√ß√µes..."></textarea>
                        </div>
                    </div>

                    <div class="button-row">
                        <button class="btn btn-primary" onclick="adicionarTarefa()">Adicionar tarefa</button>
                        <button class="btn btn-secondary" onclick="salvarDados()">Salvar Dados</button>
                        <button class="btn btn-danger" onclick="resetarDados()">Reset</button>
                        <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="carregarBackup()">
                        <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">Carregar Backup</button>
                        <button class="btn btn-secondary" onclick="exportarJSON()">Exportar JSON</button>
                    </div>

                    <small style="color: #666; margin-top: 10px; display: block;">Salvo localmente (persistente)</small>
                </div>

                <!-- Contadores -->
                <div class="counters-container">
                    <h4 style="margin-bottom: 15px;">Contadores</h4>
                    <div class="counters-grid">
                        <div class="counter-item">
                            <div class="counter-number" id="contadorAbertas">0</div>
                            <div class="counter-label">Tarefas em aberto</div>
                        </div>
                        <div class="counter-item">
                            <div class="counter-number" id="contadorExecucao">0</div>
                            <div class="counter-label">Em execu√ß√£o</div>
                        </div>
                        <div class="counter-item">
                            <div class="counter-number" id="contadorPreciso">0</div>
                            <div class="counter-label">Aguardando PRECISO</div>
                        </div>
                        <div class="counter-item">
                            <div class="counter-number" id="contadorValidacao">0</div>
                            <div class="counter-label">Aguardando valida√ß√£o</div>
                        </div>
                        <div class="counter-item">
                            <div class="counter-number" id="contadorAssinatura">0</div>
                            <div class="counter-label">Aguardando assinatura</div>
                        </div>
                        <div class="counter-item">
                            <div class="counter-number" id="contadorRetorno">0</div>
                            <div class="counter-label">Aguardando retorno associado</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o de Altas Prioridades -->
            <div class="high-priority-section">
                <h4>Altas prioridades (abertas)</h4>
                <div id="altasPrioridades">Nenhuma</div>
                
                <h4 style="margin-top: 15px;">üî∂ PRECISO vencendo (√∫ltimos 5 dias)</h4>
                <div id="precisoVencendo">Nenhum</div>
            </div>

            <!-- Lista de Tarefas -->
            <div class="task-list-container">
                <h4>Lista de Tarefas</h4>
                
                <!-- Filtros -->
                <div class="filters-row">
                    <div class="form-group">
                        <label for="filtroGeral">Filtro Geral</label>
                        <select id="filtroGeral" onchange="aplicarFiltros()">
                            <option value="abertas">Apenas Abertas</option>
                            <option value="todas">Todas as Solicita√ß√µes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filtroSolicitante">Filtrar por Solicitante</label>
                        <select id="filtroSolicitante" onchange="aplicarFiltros()">
                            <option value="">Todos</option>
                            <option value="Josiane">Josiane</option>
                            <option value="Val">Val</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filtroCPF">Filtrar por CPF</label>
                        <input type="text" id="filtroCPF" onkeyup="aplicarFiltros()">
                    </div>
                    <div class="form-group">
                        <label for="filtroNome">Filtrar por Nome</label>
                        <input type="text" id="filtroNome" onkeyup="aplicarFiltros()">
                    </div>
                </div>

                <div id="totalFiltrado" style="margin-bottom: 15px; font-weight: 500;"></div>
                
                <table class="task-table" id="taskTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>CPF</th>
                            <th>Nome</th>
                            <th>Solicitante</th>
                            <th>Prioridade</th>
                            <th>Status</th>
                            <th>Data Solicita√ß√£o</th>
                            <th>Data Vencimento</th>
                            <th>PRECISO</th>
                            <th>PRECISO Vencimento</th>
                            <th>Observa√ß√µes</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="taskTableBody">
                    </tbody>
                </table>

                <!-- Se√ß√£o de Edi√ß√£o -->
                <div id="editSection" class="edit-section hidden">
                    <h4 id="editTitle">Editando Tarefa</h4>
                    <div class="edit-row">
                        <div class="form-group">
                            <label for="editStatus">Status</label>
                            <select id="editStatus" onchange="togglePrecisoFields()">
                                <option value="Aberta">Aberta</option>
                                <option value="Em execu√ß√£o">Em execu√ß√£o</option>
                                <option value="Aguardando assinatura">Aguardando assinatura</option>
                                <option value="Aguardando retorno associado">Aguardando retorno associado</option>
                                <option value="Aguardando valida√ß√£o">Aguardando valida√ß√£o</option>
                                <option value="Conclu√≠do">Conclu√≠do</option>
                                <option value="Aguardando PRECISO">Aguardando PRECISO</option>
                            </select>
                        </div>
                        <div class="form-group" id="precisoNumeroGroup" style="display: none;">
                            <label for="editPrecisoNumero">N√∫mero PRECISO</label>
                            <input type="text" id="editPrecisoNumero">
                        </div>
                        <div class="form-group" id="precisoDataGroup" style="display: none;">
                            <label for="editPrecisoData">Data Vencimento PRECISO</label>
                            <input type="date" id="editPrecisoData">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editObservacoes">Observa√ß√µes</label>
                            <textarea id="editObservacoes"></textarea>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="salvarEdicao()">Salvar Altera√ß√µes</button>
                        <button class="btn btn-secondary" onclick="cancelarEdicao()">Cancelar Edi√ß√£o</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- P√°gina Administrador -->
        <div id="adminPage" class="hidden">
            <h2>üë®‚Äçüíº √Årea do Administrador</h2>
            <div class="admin-section">
                <h3>Gerenciar Solicitantes</h3>
                <div class="solicitantes-grid">
                    <div>
                        <h4>Solicitantes Atuais:</h4>
                        <div id="solicitantesAtuais"></div>
                    </div>
                    <div>
                        <h4>Adicionar Novo Solicitante:</h4>
                        <div class="form-group">
                            <input type="text" id="novoSolicitante" placeholder="Nome do novo solicitante">
                            <button class="btn btn-primary" onclick="adicionarSolicitante()" style="margin-top: 10px;">Adicionar Solicitante</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- P√°gina Relat√≥rios -->
        <div id="relatoriosPage" class="hidden">
            <h2>üìä Dashboard e Relat√≥rios</h2>
            <div class="dashboard-section">
                <div class="chart-container">
                    <h3>Distribui√ß√£o de Tarefas por Status</h3>
                    <canvas id="pieChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Relat√≥rio Detalhado</h3>
                    <table class="task-table">
                        <thead>
                            <tr>
                                <th>M√©trica</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody id="relatorioDetalhado">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Dados globais
        let tarefas = JSON.parse(localStorage.getItem('tarefas')) || [];
        let contadorId = parseInt(localStorage.getItem('contadorId')) || 1;
        let solicitantes = JSON.parse(localStorage.getItem('solicitantes')) || ["Josiane", "Val"];
        let tarefaEditandoId = null;

        // Inicializar aplica√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            atualizarSolicitantesSelect();
            atualizarContadores();
            atualizarAltasPrioridades();
            aplicarFiltros();
            atualizarAdminPage();
        });

        // Navega√ß√£o entre p√°ginas
        function showPage(page) {
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('relatoriosPage').classList.add('hidden');
            
            document.getElementById(page + 'Page').classList.remove('hidden');
            
            if (page === 'relatorios') {
                atualizarRelatorios();
            }
        }

        // Toggle data prazo
        function toggleDataPrazo() {
            const prioridade = document.getElementById('prioridade').value;
            const dataPrazo = document.getElementById('dataPrazo');
            dataPrazo.disabled = prioridade !== 'Alta';
            if (prioridade !== 'Alta') {
                dataPrazo.value = '';
            }
        }

        // Calcular data de vencimento (4 dias √∫teis)
        function calcularDataVencimento(dataInicio) {
            let dataAtual = new Date(dataInicio);
            let diasAdicionados = 0;
            
            while (diasAdicionados < 4) {
                dataAtual.setDate(dataAtual.getDate() + 1);
                if (dataAtual.getDay() >= 1 && dataAtual.getDay() <= 5) { // Segunda a sexta
                    diasAdicionados++;
                }
            }
            
            return dataAtual;
        }

        // Adicionar tarefa
        function adicionarTarefa() {
            const cpf = document.getElementById('cpf').value;
            const nome = document.getElementById('nome').value;
            const solicitante = document.getElementById('solicitante').value;
            const prioridade = document.getElementById('prioridade').value;
            const dataPrazo = document.getElementById('dataPrazo').value;
            const observacoes = document.getElementById('observacoes').value;

            if (!cpf || !nome) {
                alert('Por favor, preencha CPF e Nome do associado.');
                return;
            }

            const dataAtual = new Date();
            let dataVencimento;
            
            if (prioridade === 'Alta' && dataPrazo) {
                dataVencimento = new Date(dataPrazo);
            } else {
                dataVencimento = calcularDataVencimento(dataAtual);
            }

            const novaTarefa = {
                id: contadorId,
                cpf: cpf,
                nome: nome,
                solicitante: solicitante,
                prioridade: prioridade,
                dataSolicitacao: dataAtual,
                dataVencimento: dataVencimento,
                status: 'Aberta',
                precisoNumero: '',
                precisoData: null,
                observacoes: observacoes,
                dataConclusao: null
            };

            tarefas.push(novaTarefa);
            contadorId++;

            // Salvar no localStorage
            localStorage.setItem('tarefas', JSON.stringify(tarefas));
            localStorage.setItem('contadorId', contadorId.toString());

            // Limpar formul√°rio
            document.getElementById('cpf').value = '';
            document.getElementById('nome').value = '';
            document.getElementById('observacoes').value = '';
            document.getElementById('dataPrazo').value = '';

            // Mostrar notifica√ß√£o
            mostrarNotificacao();
            
            // Tocar som de notifica√ß√£o
            playNotificationSound();

            // Atualizar interface
            atualizarContadores();
            atualizarAltasPrioridades();
            aplicarFiltros();
        }

        // Mostrar notifica√ß√£o
        function mostrarNotificacao() {
            const alert = document.getElementById('novaTagrefaAlert');
            alert.classList.remove('hidden');
            setTimeout(() => {
                alert.classList.add('hidden');
            }, 3000);
        }

        // Tocar som de notifica√ß√£o
        function playNotificationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Som de notifica√ß√£o n√£o suportado neste navegador');
            }
        }

        // Atualizar contadores
        function atualizarContadores() {
            const contadores = {
                abertas: tarefas.filter(t => t.status === 'Aberta').length,
                execucao: tarefas.filter(t => t.status === 'Em execu√ß√£o').length,
                aguardandoPreciso: tarefas.filter(t => t.status === 'Aguardando PRECISO').length,
                aguardandoValidacao: tarefas.filter(t => t.status === 'Aguardando valida√ß√£o').length,
                aguardandoAssinatura: tarefas.filter(t => t.status === 'Aguardando assinatura').length,
                aguardandoRetorno: tarefas.filter(t => t.status === 'Aguardando retorno associado').length
            };

            document.getElementById('contadorAbertas').textContent = contadores.abertas;
            document.getElementById('contadorExecucao').textContent = contadores.execucao;
            document.getElementById('contadorPreciso').textContent = contadores.aguardandoPreciso;
            document.getElementById('contadorValidacao').textContent = contadores.aguardandoValidacao;
            document.getElementById('contadorAssinatura').textContent = contadores.aguardandoAssinatura;
            document.getElementById('contadorRetorno').textContent = contadores.aguardandoRetorno;
        }

        // Atualizar altas prioridades
        function atualizarAltasPrioridades() {
            const altasPrioridades = tarefas.filter(t => t.prioridade === 'Alta' && t.status !== 'Conclu√≠do');
            const altasPrioridadesDiv = document.getElementById('altasPrioridades');
            
            if (altasPrioridades.length === 0) {
                altasPrioridadesDiv.innerHTML = 'Nenhuma';
            } else {
                altasPrioridadesDiv.innerHTML = altasPrioridades.map(t => 
                    `<div class="clickable-task" onclick="editarTarefa(${t.id})">‚Ä¢ Tarefa #${t.id} - ${t.nome} - ${t.solicitante}</div>`
                ).join('');
            }

            // PRECISO vencendo
            const precisoVencendo = [];
            const hoje = new Date();
            
            tarefas.forEach(tarefa => {
                if (tarefa.status === 'Aguardando PRECISO' && tarefa.precisoData) {
                    const precisoDate = new Date(tarefa.precisoData);
                    const diasRestantes = Math.ceil((precisoDate - hoje) / (1000 * 60 * 60 * 24));
                    
                    if (diasRestantes <= 5) {
                        precisoVencendo.push({tarefa, diasRestantes});
                    }
                }
            });

            const precisoVencendoDiv = document.getElementById('precisoVencendo');
            
            if (precisoVencendo.length === 0) {
                precisoVencendoDiv.innerHTML = 'Nenhum';
            } else {
                precisoVencendoDiv.innerHTML = precisoVencendo.map(({tarefa, diasRestantes}) => {
                    const classe = diasRestantes <= 0 ? 'style="color: red; font-weight: bold;"' : 'style="color: orange;"';
                    const texto = diasRestantes <= 0 ? 'VENCIDO' : `vence em ${diasRestantes} dia(s)`;
                    return `<div ${classe}>PRECISO #${tarefa.precisoNumero} ${texto} - Tarefa #${tarefa.id} - Vencimento: ${new Date(tarefa.precisoData).toLocaleDateString('pt-BR')}</div>`;
                }).join('');
            }
        }

        // Aplicar filtros
        function aplicarFiltros() {
            const filtroGeral = document.getElementById('filtroGeral').value;
            const filtroSolicitante = document.getElementById('filtroSolicitante').value;
            const filtroCPF = document.getElementById('filtroCPF').value.toLowerCase();
            const filtroNome = document.getElementById('filtroNome').value.toLowerCase();

            let tarefasFiltradas = tarefas.slice();

            if (filtroGeral === 'abertas') {
                tarefasFiltradas = tarefasFiltradas.filter(t => t.status === 'Aberta');
            }

            if (filtroSolicitante) {
                tarefasFiltradas = tarefasFiltradas.filter(t => t.solicitante === filtroSolicitante);
            }

            if (filtroCPF) {
                tarefasFiltradas = tarefasFiltradas.filter(t => t.cpf.toLowerCase().includes(filtroCPF));
            }

            if (filtroNome) {
                tarefasFiltradas = tarefasFiltradas.filter(t => t.nome.toLowerCase().includes(filtroNome));
            }

            document.getElementById('totalFiltrado').textContent = `Total filtrado: ${tarefasFiltradas.length}`;

            const tbody = document.getElementById('taskTableBody');
            tbody.innerHTML = '';

            tarefasFiltradas.forEach(tarefa => {
                const row = tbody.insertRow();
                
                const statusClass = getStatusClass(tarefa.status);
                const priorityClass = getPriorityClass(tarefa.prioridade);
                
                row.innerHTML = `
                    <td>${tarefa.id}</td>
                    <td>${tarefa.cpf}</td>
                    <td>${tarefa.nome}</td>
                    <td>${tarefa.solicitante}</td>
                    <td class="${priorityClass}">${tarefa.prioridade}</td>
                    <td><span class="status-badge ${statusClass}">${tarefa.status}</span></td>
                    <td>${new Date(tarefa.dataSolicitacao).toLocaleDateString('pt-BR')}</td>
                    <td>${new Date(tarefa.dataVencimento).toLocaleDateString('pt-BR')}</td>
                    <td>${tarefa.precisoNumero || '-'}</td>
                    <td>${tarefa.precisoData ? new Date(tarefa.precisoData).toLocaleDateString('pt-BR') : '-'}</td>
                    <td>${tarefa.observacoes.length > 30 ? tarefa.observacoes.substring(0, 30) + '...' : tarefa.observacoes}</td>
                    <td><button class="btn btn-primary" onclick="editarTarefa(${tarefa.id})">Editar</button></td>
                `;
            });
        }

        // Classes CSS para status e prioridade
        function getStatusClass(status) {
            switch (status) {
                case 'Aberta': return 'status-aberta';
                case 'Em execu√ß√£o': return 'status-execucao';
                case 'Conclu√≠do': return 'status-concluido';
                default: return 'status-aguardando';
            }
        }

        function getPriorityClass(prioridade) {
            switch (prioridade) {
                case 'Alta': return 'priority-alta';
                case 'M√©dia': return 'priority-media';
                case 'Baixa': return 'priority-baixa';
                default: return '';
            }
        }

        // Editar tarefa
        function editarTarefa(id) {
            const tarefa = tarefas.find(t => t.id === id);
            if (!tarefa) return;

            tarefaEditandoId = id;
            
            document.getElementById('editTitle').textContent = `Editando Tarefa #${tarefa.id} - ${tarefa.nome}`;
            document.getElementById('editStatus').value = tarefa.status;
            document.getElementById('editObservacoes').value = tarefa.observacoes;
            document.getElementById('editPrecisoNumero').value = tarefa.precisoNumero;
            document.getElementById('editPrecisoData').value = tarefa.precisoData ? new Date(tarefa.precisoData).toISOString().split('T')[0] : '';
            
            togglePrecisoFields();
            document.getElementById('editSection').classList.remove('hidden');
            document.getElementById('editSection').scrollIntoView();
        }

        // Toggle campos PRECISO
        function togglePrecisoFields() {
            const status = document.getElementById('editStatus').value;
            const isPreciso = status === 'Aguardando PRECISO';
            
            document.getElementById('precisoNumeroGroup').style.display = isPreciso ? 'block' : 'none';
            document.getElementById('precisoDataGroup').style.display = isPreciso ? 'block' : 'none';
        }

        // Salvar edi√ß√£o
        function salvarEdicao() {
            if (tarefaEditandoId === null) return;

            const tarefa = tarefas.find(t => t.id === tarefaEditandoId);
            if (!tarefa) return;

            const novoStatus = document.getElementById('editStatus').value;
            const novasObservacoes = document.getElementById('editObservacoes').value;
            
            tarefa.status = novoStatus;
            tarefa.observacoes = novasObservacoes;

            if (novoStatus === 'Aguardando PRECISO') {
                tarefa.precisoNumero = document.getElementById('editPrecisoNumero').value;
                tarefa.precisoData = document.getElementById('editPrecisoData').value ? new Date(document.getElementById('editPrecisoData').value) : null;
            } else {
                tarefa.precisoNumero = '';
                tarefa.precisoData = null;
            }

            if (novoStatus === 'Conclu√≠do') {
                tarefa.dataConclusao = new Date();
            }

            // Salvar no localStorage
            localStorage.setItem('tarefas', JSON.stringify(tarefas));

            cancelarEdicao();
            atualizarContadores();
            atualizarAltasPrioridades();
            aplicarFiltros();

            alert('Tarefa atualizada com sucesso!');
        }

        // Cancelar edi√ß√£o
        function cancelarEdicao() {
            tarefaEditandoId = null;
            document.getElementById('editSection').classList.add('hidden');
        }

        // Salvar dados
        function salvarDados() {
            const dados = {
                tarefas: tarefas,
                solicitantes: solicitantes,
                contadorId: contadorId
            };

            const dataStr = JSON.stringify(dados, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `backup_tarefas_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            link.click();
        }

        // Resetar dados
        function resetarDados() {
            if (confirm('Tem certeza que deseja resetar todos os dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
                tarefas = [];
                contadorId = 1;
                tarefaEditandoId = null;
                
                localStorage.removeItem('tarefas');
                localStorage.removeItem('contadorId');
                
                atualizarContadores();
                atualizarAltasPrioridades();
                aplicarFiltros();
                
                alert('Dados resetados com sucesso!');
            }
        }

        // Carregar backup
        function carregarBackup() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    
                    tarefas = dados.tarefas || [];
                    solicitantes = dados.solicitantes || ["Josiane", "Val"];
                    contadorId = dados.contadorId || 1;

                    // Converter strings de data de volta para Date objects
                    tarefas.forEach(tarefa => {
                        if (tarefa.dataSolicitacao) tarefa.dataSolicitacao = new Date(tarefa.dataSolicitacao);
                        if (tarefa.dataVencimento) tarefa.dataVencimento = new Date(tarefa.dataVencimento);
                        if (tarefa.dataConclusao) tarefa.dataConclusao = new Date(tarefa.dataConclusao);
                        if (tarefa.precisoData) tarefa.precisoData = new Date(tarefa.precisoData);
                    });

                    // Salvar no localStorage
                    localStorage.setItem('tarefas', JSON.stringify(tarefas));
                    localStorage.setItem('solicitantes', JSON.stringify(solicitantes));
                    localStorage.setItem('contadorId', contadorId.toString());

                    atualizarSolicitantesSelect();
                    atualizarContadores();
                    atualizarAltasPrioridades();
                    aplicarFiltros();
                    atualizarAdminPage();

                    alert('Backup carregado com sucesso!');
                } catch (error) {
                    alert('Erro ao carregar backup: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Exportar JSON
        function exportarJSON() {
            const dataStr = JSON.stringify(tarefas, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `tarefas_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            link.click();
        }

        // Atualizar select de solicitantes
        function atualizarSolicitantesSelect() {
            const select = document.getElementById('solicitante');
            const filtroSelect = document.getElementById('filtroSolicitante');
            
            select.innerHTML = '';
            filtroSelect.innerHTML = '<option value="">Todos</option>';
            
            solicitantes.forEach(solicitante => {
                select.innerHTML += `<option value="${solicitante}">${solicitante}</option>`;
                filtroSelect.innerHTML += `<option value="${solicitante}">${solicitante}</option>`;
            });
        }

        // Administrador - Adicionar solicitante
        function adicionarSolicitante() {
            const novoSolicitante = document.getElementById('novoSolicitante').value.trim();
            
            if (!novoSolicitante) {
                alert('Por favor, digite o nome do solicitante.');
                return;
            }

            if (solicitantes.includes(novoSolicitante)) {
                alert('Este solicitante j√° existe.');
                return;
            }

            solicitantes.push(novoSolicitante);
            localStorage.setItem('solicitantes', JSON.stringify(solicitantes));
            
            document.getElementById('novoSolicitante').value = '';
            atualizarSolicitantesSelect();
            atualizarAdminPage();
            
            alert(`Solicitante '${novoSolicitante}' adicionado com sucesso!`);
        }

        // Administrador - Remover solicitante
        function removerSolicitante(index) {
            if (confirm(`Tem certeza que deseja remover '${solicitantes[index]}'?`)) {
                solicitantes.splice(index, 1);
                localStorage.setItem('solicitantes', JSON.stringify(solicitantes));
                atualizarSolicitantesSelect();
                atualizarAdminPage();
            }
        }

        // Atualizar p√°gina do administrador
        function atualizarAdminPage() {
            const container = document.getElementById('solicitantesAtuais');
            container.innerHTML = '';
            
            solicitantes.forEach((solicitante, index) => {
                const div = document.createElement('div');
                div.style.marginBottom = '10px';
                div.innerHTML = `
                    <input type="text" value="${solicitante}" onchange="editarSolicitante(${index}, this.value)" style="margin-right: 10px;">
                    <button class="btn btn-danger" onclick="removerSolicitante(${index})">üóëÔ∏è</button>
                `;
                container.appendChild(div);
            });
        }

        // Editar solicitante
        function editarSolicitante(index, novoNome) {
            if (novoNome.trim() && novoNome !== solicitantes[index]) {
                solicitantes[index] = novoNome.trim();
                localStorage.setItem('solicitantes', JSON.stringify(solicitantes));
                atualizarSolicitantesSelect();
            }
        }

        // Atualizar relat√≥rios
        function atualizarRelatorios() {
            const contadores = {
                total: tarefas.length,
                abertas: tarefas.filter(t => t.status === 'Aberta').length,
                execucao: tarefas.filter(t => t.status === 'Em execu√ß√£o').length,
                concluidas: tarefas.filter(t => t.status === 'Conclu√≠do').length,
                aguardandoPreciso: tarefas.filter(t => t.status === 'Aguardando PRECISO').length,
                aguardandoValidacao: tarefas.filter(t => t.status === 'Aguardando valida√ß√£o').length
            };

            // Atualizar tabela de relat√≥rio
            const tbody = document.getElementById('relatorioDetalhado');
            tbody.innerHTML = `
                <tr><td>Total de Tarefas</td><td>${contadores.total}</td></tr>
                <tr><td>Tarefas Abertas</td><td>${contadores.abertas}</td></tr>
                <tr><td>Em Execu√ß√£o</td><td>${contadores.execucao}</td></tr>
                <tr><td>Conclu√≠das</td><td>${contadores.concluidas}</td></tr>
                <tr><td>Aguardando PRECISO</td><td>${contadores.aguardandoPreciso}</td></tr>
                <tr><td>Aguardando Valida√ß√£o</td><td>${contadores.aguardandoValidacao}</td></tr>
            `;

            // Atualizar gr√°fico de pizza
            const ctx = document.getElementById('pieChart').getContext('2d');
            
            // Destruir gr√°fico anterior se existir
            if (window.pieChart) {
                window.pieChart.destroy();
            }
            
            window.pieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Abertas', 'Em Execu√ß√£o', 'Conclu√≠das', 'Aguardando'],
                    datasets: [{
                        data: [
                            contadores.abertas,
                            contadores.execucao,
                            contadores.concluidas,
                            contadores.aguardandoPreciso + contadores.aguardandoValidacao
                        ],
                        backgroundColor: [
                            '#fff3cd',
                            '#cce5ff',
                            '#d4edda',
                            '#f8d7da'
                        ],
                        borderColor: [
                            '#856404',
                            '#004085',
                            '#155724',
                            '#721c24'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>